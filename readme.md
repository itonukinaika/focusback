#focusback v0.8 by 糸貫内科クリニック

環境によって、WiseScopeの先読みウィンドウがウィンドウフォーカスを所得して、操作中のウィンドウのキー操作ができなくなる問題の一時的修正プログラム


NTT東日本の電子カルテ「FC21Warp」とJustSystem「ATOK」を併用すると、文字入力中に電子カルテの先読みウィンドウ（デスクトップ座標範囲外に生成される）にキーボードフォーカスを取られてしまい、操作効率が低下してしまいます。
このプログラムは、先読みウィンドウにフォーカスが移ったことを検知すると、元のウィンドウにフォーカスを戻します。
運が悪いと、間違ったウィンドウにフォーカスが戻ってしまうことがあります。

##仕様：
Windowsのウィンドウフォーカス移動を監視し、フォーカスされたウィンドウに名前があれば、通常のウィンドウと判断してウィンドウハンドルを保存します
フォーカスされたウィンドウに名前が無い場合は、Wise.Scope.Karte.exeによって生成されたウィンドウであるか確認し、さらにウィンドウの座標が画面外にあることを確認します
もしそうであれば、WiseScopeの先読みウィンドウにフォーカスが移動したとみなし、先の手順で保存していたハンドルのウィンドウにフォーカスをもどします。


focusback.exe 通常の実行ファイル、実行すると常駐して上記動作を行います（通常、こちらの実行ファイルをスタートアップに登録して用います）


###v0.8
入力スレッドのアタッチで不具合が生じるため、単純に100msec待ってからウィンドウを切り替えるようにしました。

###v0.7
先読みウィンドウにフォーカスが移動したことを検出すると、当該ウィンドウを非表示に切り替えるようにしました。
先読みウィンドウを非表示としても、適切なウィンドウにフォーカスが戻らないときのみ、強制的にフォーカスを戻します。
入力スレッドのアタッチなしでウィンドウフォーカスが戻らないときのみ、アタッチするようにしました。

###v0.6
戻し先ウィンドウが存在しない場合に、入力スレッドのアタッチが解除されないバグを修正しました。
コードの体裁を整え、可読性を向上しました。

###v0.5
Windowsのフォーカス移動制限回避のため、ウィンドウフォーカスを戻すときに、一時的に操作する各ウィンドウの入力スレッドにアタッチするようにしました。

###v0.4
Wise.Scope.Karte.exeによって生成された名前の無いウィンドウ（検査結果時系列画面での、「項目選択」ウィンドウなど）
にフォーカスが移動すると誤作動し、操作不能になる問題の修正

###v0.3
フォーカス移動先の実行ファイル名を確認し、Wise.Scope.Karte.exeによって生成された先読みウィンドウのみに反応して動作するようにしました
デバッグ表示ができるようにしました
不要なウィンドウプロシジャを削除しました
